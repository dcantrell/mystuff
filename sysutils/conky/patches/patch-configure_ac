$OpenBSD$
--- configure.ac.orig	Mon Aug 24 19:01:53 2009
+++ configure.ac	Mon May 16 15:38:24 2011
@@ -67,6 +67,7 @@ case $uname in
   OpenBSD*)
     WANT_KVM=yes
     WANT_OSSLIB=yes
+    WANT_APM=yes
     ;;
 
 # Solaris doesn't work at all right now
@@ -718,6 +719,14 @@ if test x$WANT_OSSLIB = xyes; then
 fi
 
 dnl
+dnl OpenBSD requires presence of specific header file
+dnl
+
+if test x$WANT_APM = xyes; then
+    AC_CHECK_HEADERS([machine/apmvar.h])
+fi
+
+dnl
 dnl ALSA for Linux
 dnl
 AC_ARG_ENABLE([alsa],
@@ -762,10 +771,7 @@ dnl
 dnl Some functions
 dnl
 
-AC_CHECK_FUNCS([calloc malloc free popen sysinfo getloadavg memrchr strndup gethostbyname_r])
-AC_SEARCH_LIBS(clock_gettime, [rt], conky_LIBS="$conky_LIBS -lrt"
-               [AC_DEFINE(HAVE_CLOCK_GETTIME, 1, [Define if you have clock_gettime()])],
-               [AC_CHECK_FUNCS([gettimeofday], [], [AC_MSG_ERROR([gettimeofday() not available!])])], [])
+AC_CHECK_FUNCS([calloc malloc free popen sysinfo getloadavg memrchr strndup gethostbyname_r clock_gettime])
 
 dnl
 dnl Structure checks
